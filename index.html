<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Recommended SKKU Courses for UiO IFI Exchange Students</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 30px; }
        table { border-collapse: collapse; width: 100%; }
        th, td { padding: 8px 12px; border: 1px solid #ccc; text-align: left; }
        th { background-color: #f2f2f2; cursor: pointer; }
        .filters { 
            margin-bottom: 20px; 
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(2, auto);
            gap: 15px;
            max-width: 1200px;
        }
        .filters label {
            display: flex;
            flex-direction: column;
            font-weight: bold;
        }
        .filters select { 
            margin-top: 5px;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .course-toggle {
            background: none;
            border: none;
            color: #0645ad;
            text-decoration: underline;
            cursor: pointer;
            padding: 0;
            font: inherit;
        }
        .course-description-cell {
            background-color: #f9f9f9;
            padding: 10px;
            font-size: 0.95em;
        }
        .seoul-row {
    background-color: #f0f8ff; /* Light blue for Seoul */
        }
        .suwon-row {
    background-color: #faf8e9; /* Light yellow for Suwon */
        }
        .active-filters {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 12px 16px;
            margin-bottom: 15px;
            font-size: 14px;
        }
        .active-filters h4 {
            margin: 0 0 8px 0;
            font-size: 16px;
            color: #495057;
        }
        .filter-tag {
            display: inline-block;
            background-color: #007bff;
            color: white;
            padding: 4px 8px;
            margin: 2px 4px 2px 0;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        .no-filters {
            color: #6c757d;
            font-style: italic;
        }
        .clear-filters-btn {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            margin-left: 10px;
            font-weight: 500;
        }
        .clear-filters-btn:hover {
            background-color: #c82333;
        }
        .selected-courses {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 12px 16px;
            margin-bottom: 15px;
            font-size: 14px;
        }
        .selected-courses h4 {
            margin: 0 0 8px 0;
            font-size: 16px;
            color: #495057;
        }
        .download-btn {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            font-weight: 500;
            margin-left: 10px;
        }
        .download-btn:hover {
            background-color: #218838;
        }
        .download-btn:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        .checkbox-column {
            width: 40px;
            text-align: center;
        }
        .course-checkbox {
            cursor: pointer;
        }
</style>
</head>
<body>

<h1>Recommended SKKU Courses for UiO IFI Exchange Students</h1>
<p>This page lists selected courses at SKKU that are relevant for UiO IFI exchange students. Clicking each course number will display the corresponding course description.
</p>
<p>Full-time studies at SKKU are <strong>15 credits</strong> for students at bachelor's level and <strong>9 credits</strong> for students at master's level. For more information, visit the
    <a href="https://www.uio.no/studier/utveksling/avtaler/asia/sor-korea/sungkyunkwan/mn.html" target="_blank">
      UiO's official webpage on student exchange programs.
    </a>
</p>
<p>Color differentiates the campus locations. <strong>Seoul (Humanities and Social Sciences Campus, HSSC)</strong> courses are shown in light blue, while <strong>Suwon (Natural Sciences Campus, NSC)</strong> courses are in light yellow. There is 
    <a href="https://www.skku.edu/eng/CampusLife/convenience/Shuttlebus.do" target="_blank">
      a shuttle bus service between the two campuses.
    </a>
</p>

<div class="selected-courses" id="selectedCourses">
    <h4>Selected Courses:</h4>
    <div id="selectedCoursesList">
        <span class="no-filters">No courses selected</span>
    </div>
</div>

<div class="active-filters" id="activeFilters">
    <h4>Active Filters:</h4>
    <div id="activeFilterTags">
        <span class="no-filters">No filters selected</span>
    </div>
</div>

<div class="filters">
    <label>Year:
    <select id="yearFilter">
        <option value="">All</option>
        <option value="2025">2025</option>
    </select>
    </label>
    <label>Semester:
    <select id="semesterFilter">
        <option value="">All</option>
        <option value="Spring">Spring</option>
        <option value="Autumn">Autumn</option>
    </select>
    </label>
    <label>Campus:
    <select id="campusFilter">
        <option value="">All</option>
        <option value="Suwon">Suwon (NSC)</option>
        <option value="Seoul">Seoul (HSSC)</option>
        <option value="Online">Online</option>
    </select>
    </label>
    <label>IFI Track:
    <select id="trackFilter">
        <option value="">All</option>
        <option value="IFI">All IFI tracks</option>
        <option value="ML">Machine Learning (ML)</option>
        <option value="PROSA">Programming and systems architecture (PROSA)</option>
        <option value="LT">Language technology (LT)</option>
        <option value="DBI">Design, Use, and Interaction (DBI)</option>
        <option value="Math">Mathematics</option>
        <option value="Others">Others</option>
    </select>
    </label>
    <label>SKKU Major:
    <select id="departmentFilter">
        <option value="">All</option>
    </select>
    </label>
    <label>Level:
    <select id="levelFilter">
        <option value="">All</option>
        <option value="BS+MS">BS+MS</option>
        <option value="BS">BS</option>
        <option value="MS">MS</option>
    </select>
    </label>
    <label>Level Category:
        <select id="levelCategoryFilter">
            <option value="">All</option>
            <option value="Common">Common</option>
            <option value="2xxx">2xxx</option>
            <option value="3xxx">3xxx</option>
            <option value="4xxx">4xxx</option>
            <option value="5xxx">5xxx</option>
        </select>
        </label>
    <label>Credits:
    <select id="creditsFilter">
        <option value="">All</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="6">6</option>
    </select>
    </label>
</div>

<p><strong>Disclaimer:</strong> This information is intended for planning purposes. Exact course availability and details may change based on SKKU's official course offerings via
    <a href="https://eportal.skku.edu/" target="_blank">
    SKKU e-portal page.
    </a>
</p>


<table id="courseTable">
    <thead>
    <tr>
        <th class="checkbox-column">Select</th>
        <th>Course Number</th>
        <th>Title</th>
        <th>Year</th>
        <th>Semester</th>
        <th>Campus</th>
        <th>Track</th>
        <th>Level</th>
        <th>Credits</th>
    </tr>
    </thead>
    <tbody></tbody>
</table>

<script>

const departmentMapping = {
    BIZ: "BIZ: Business Administration",
    BUS: "BUS: Business Administration",
    CNT: "CNT: Culture and Technology",
    COM: "COM: Artificial Intelligence and Immersive Media Engineering",
    CON: "CON: Consumer Science",
    COS: "COS: Confucian Studies and Eastern Philosophy",
    CSE: "CSE: Data Science and Artificial Intelligence",
    DAI: "DAI: Artificial Intelligence and Immersive Media Engineering",
    DASF: "DASF: Data Science and Artificial Intelligence",
    DBA: "DBA: Business Administration",
    DES: "DES: Design",
    DIM: "DIM: Artificial Intelligence and Immersive Media Engineering",
    DSC: "DSC: Artificial Intelligence and Immersive Media Engineering",
    ECE: "ECE: Electrical and Computer Engineering",
    ECO: "ECO: Economics",
    EEE: "EEE: Electronic and Electrical Engineering",
    EME: "EME: Robotics and Mechanical Engineering",
    ERC: "ERC: Mathematics",
    ESM: "ESM: Systems Management Engineering",
    FTM: "FTM: Culture and Technology",
    GEDB: "GEDB: Electives",
    GEDH: "GEDH: Electives",
    GEDN: "GEDN: Electives",
    GEDS: "GEDS: Electives",
    GELT: "GELT: Electives",
    HAI: "HAI: Artificial Intelligence and Interaction Science",
    ICE: "ICE: Information and Communication Engineering",
    IEC: "IEC: Exchange/Visiting",
    LIS: "LIS: Library and Information Science",
    MAE: "MAE: Mathematics Education",
    MCJ: "MCJ: Culture and Technology",
    MTH: "MTH: Mathematics",
    PHY: "PHY: Physics",
    PSY: "PSY: Psychology",
    ROB: "ROB: Robotics and Mechanical Engineering",
    STA: "STA: Statistics",
    SUP: "SUP: Data Science and Artificial Intelligence",
    SWE: "SWE: Intelligent Software Engineering",
    WIS: "WIS: Artificial Intelligence and Interaction Science"
};

let selectedCourses = new Set();

async function loadCoursesFromCSV() {
    const response = await fetch('courses2025_cleaned.csv');
    const data = await response.text();
    const rows = data.trim().split('\n');
    const headers = rows.shift().split(',');

    const tbody = document.querySelector("#courseTable tbody");
    tbody.innerHTML = '';

    const departments = new Set();

    const levels = new Set();

    for (const row of rows) {
        const cols = parseCSVLine(row);
        const [course, title, year, sem, campus, track, level, credits, desc] = cols;

        // Extract department and level from the course code
        const department = course.match(/[A-Za-z]+/)[0]; // Letter part
        const departmentFull = departmentMapping[department] || department; // Map to full name or fallback to short name
        const courseLevel = parseInt(course.match(/\d+/)[0], 10); // Number part

        // Add department full name to the set for filter options
        departments.add(departmentFull);
        if (courseLevel < 1000) {
            levels.add('Common');
        } else if (courseLevel >= 2000 && courseLevel < 3000) {
            levels.add('2xxx');
        } else if (courseLevel >= 3000 && courseLevel < 4000) {
            levels.add('3xxx');
        } else if (courseLevel >= 4000 && courseLevel < 5000) {
            levels.add('4xxx');
        } else if (courseLevel >= 5000 && courseLevel < 6000) {
            levels.add('5xxx');
        }

        const mainRow = document.createElement('tr');
        const campusClass = campus === "Seoul" ? "seoul-row" : campus === "Suwon" ? "suwon-row" : "";
        mainRow.className = campusClass; // Apply the class based on campus

        mainRow.innerHTML = `
            <td class="checkbox-column"><input type="checkbox" class="course-checkbox" data-course="${course}" data-title="${title}" data-year="${year}" data-semester="${sem}" data-campus="${campus}" data-track="${track}" data-level="${level}" data-credits="${credits}" onchange="toggleCourseSelection(this)"></td>
            <td><button class="course-toggle" data-description="${desc}">${course}</button></td>
            <td>${title}</td>
            <td>${year}</td>
            <td>${sem}</td>
            <td>${campus}</td>
            <td>${track}</td>
            <td>${level}</td>
            <td>${credits}</td>
        `;

        const descRow = document.createElement('tr');
        descRow.className = "course-description-row";
        descRow.style.display = "none";
        descRow.innerHTML = `<td colspan="9" class="course-description-cell"></td>`;

        tbody.appendChild(mainRow);
        tbody.appendChild(descRow);
    }

    // Populate department and level filters
    populateFilterOptions('departmentFilter', Object.values(departmentMapping).sort());
    populateFilterOptions('levelCategoryFilter', ['Common', '2xxx', '3xxx', '4xxx', '5xxx']);

    attachToggleLogic();
    filterTable();
    updateSelectedCoursesDisplay();
}


function populateFilterOptions(filterId, options) {
    const filter = document.getElementById(filterId);
    filter.innerHTML = '<option value="">All</option>';
    options.forEach(option => {
        const opt = document.createElement('option');
        if (filterId === 'departmentFilter') {
            opt.value = option.split(": ")[1]; // Use full name as the value
            opt.textContent = option; // Display shortName: fullName in the dropdown
        } else {
            opt.value = option;
            opt.textContent = option;
        }
        filter.appendChild(opt);
    });
}
function parseCSVLine(line) {
    const regex = /(".*?"|[^",\s]+)(?=\s*,|\s*$)/g;
    const result = [];
    let match;
    while ((match = regex.exec(line)) !== null) {
        let value = match[1];
        if (value.startsWith('"') && value.endsWith('"')) {
            value = value.slice(1, -1).replace(/""/g, '"');
        }
        result.push(value);
    }
    return result;
}

function attachToggleLogic() {
    document.querySelectorAll('.course-toggle').forEach(button => {
        button.addEventListener('click', () => {
            const row = button.closest('tr');
            const nextRow = row.nextElementSibling;
            const descCell = nextRow.querySelector('.course-description-cell');
            const isVisible = nextRow.style.display === '';
            nextRow.style.display = isVisible ? 'none' : '';
            descCell.innerHTML = isVisible ? '' : `<strong>Course Description:</strong> ${button.dataset.description}`;
        });
    });
}

const filters = {
    year: document.getElementById('yearFilter'),
    semester: document.getElementById('semesterFilter'),
    campus: document.getElementById('campusFilter'),
    track: document.getElementById('trackFilter'),
    department: document.getElementById('departmentFilter'),
    credits: document.getElementById('creditsFilter'),
    level: document.getElementById('levelFilter'),
    levelCategory: document.getElementById('levelCategoryFilter')
};

function updateActiveFilters() {
    const activeFilterTags = document.getElementById('activeFilterTags');
    const filterLabels = {
        year: 'Year',
        semester: 'Semester',
        campus: 'Campus',
        track: 'IFI Track',
        department: 'SKKU Major',
        level: 'Level',
        levelCategory: 'Level Category',
        credits: 'Credits'
    };
    
    const activeTags = [];
    
    Object.entries(filters).forEach(([key, filter]) => {
        if (filter.value && filter.value !== '') {
            let displayValue = filter.value;
            if (key === 'department') {
                // For department, show the short code instead of full name
                const departmentEntry = Object.entries(departmentMapping).find(([short, full]) => 
                    full.split(": ")[1] === filter.value
                );
                displayValue = departmentEntry ? departmentEntry[0] : filter.value;
            }
            activeTags.push(`<span class="filter-tag">${filterLabels[key]}: ${displayValue}</span>`);
        }
    });
    
    if (activeTags.length === 0) {
        activeFilterTags.innerHTML = '<span class="no-filters">No filters selected</span>';
    } else {
        activeFilterTags.innerHTML = activeTags.join('') + '<button class="clear-filters-btn" onclick="clearAllFilters()">Clear All</button>';
    }
}

function clearAllFilters() {
    Object.values(filters).forEach(filter => {
        filter.value = '';
    });
    filterTable();
}

function toggleCourseSelection(checkbox) {
    const courseData = {
        course: checkbox.dataset.course,
        title: checkbox.dataset.title,
        year: checkbox.dataset.year,
        semester: checkbox.dataset.semester,
        campus: checkbox.dataset.campus,
        track: checkbox.dataset.track,
        level: checkbox.dataset.level,
        credits: checkbox.dataset.credits
    };
    
    if (checkbox.checked) {
        selectedCourses.add(JSON.stringify(courseData));
    } else {
        selectedCourses.delete(JSON.stringify(courseData));
    }
    
    updateSelectedCoursesDisplay();
}

function updateSelectedCoursesDisplay() {
    const selectedCoursesList = document.getElementById('selectedCoursesList');
    
    if (selectedCourses.size === 0) {
        selectedCoursesList.innerHTML = '<span class="no-filters">No courses selected</span>';
    } else {
        const courseItems = Array.from(selectedCourses).map(courseJson => {
            const course = JSON.parse(courseJson);
            return `<span class="filter-tag">${course.course} - ${course.title}</span>`;
        });
        
        selectedCoursesList.innerHTML = courseItems.join('') + 
            `<button class="download-btn" onclick="downloadSelectedCourses()">Download CSV</button>`;
    }
}

function downloadSelectedCourses() {
    if (selectedCourses.size === 0) return;
    
    const headers = ['Course Number', 'Title', 'Year', 'Semester', 'Campus', 'Track', 'Level', 'Credits'];
    const csvContent = [
        headers.join(','),
        ...Array.from(selectedCourses).map(courseJson => {
            const course = JSON.parse(courseJson);
            return [
                course.course,
                `"${course.title}"`,
                course.year,
                course.semester,
                course.campus,
                course.track,
                course.level,
                course.credits
            ].join(',');
        })
    ].join('\n');
    
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    link.setAttribute('href', url);
    link.setAttribute('download', 'selected_courses.csv');
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

function filterTable() {
    const allRows = document.querySelectorAll("#courseTable tbody tr");
    allRows.forEach(row => {
        if (row.classList.contains("course-description-row")) {
            row.style.display = "none";
            row.querySelector(".course-description-cell").innerHTML = "";
            return;
        }

        const course = row.children[1].textContent.trim(); // Updated index due to checkbox column
        const departmentShort = course.match(/[A-Za-z]+/)[0]; // Extract short code
        const departmentFull = departmentMapping[departmentShort] || departmentShort; // Map to full name

        const courseLevel = parseInt(course.match(/\d+/)[0], 10);
        const levelCategory = courseLevel < 1000 ? 'Common' :
                              courseLevel >= 2000 && courseLevel < 3000 ? '2xxx' :
                              courseLevel >= 3000 && courseLevel < 4000 ? '3xxx' :
                              courseLevel >= 4000 && courseLevel < 5000 ? '4xxx' :
                              '5xxx';

        const year = row.children[3].textContent.trim(); // Updated index
        const semester = row.children[4].textContent.trim(); // Updated index
        const campus = row.children[5].textContent.trim(); // Updated index
        const track = row.children[6].textContent.trim(); // Updated index
        const level = row.children[7].textContent.trim(); // Updated index
        const credits = row.children[8].textContent.trim(); // Updated index

        const show = (!filters.year.value || filters.year.value === year) &&
                     (!filters.semester.value || filters.semester.value === semester) &&
                     (!filters.campus.value || filters.campus.value === campus) &&
                     (!filters.track.value || filters.track.value === track) &&
                     (!filters.level.value || filters.level.value === level) &&
                     (!filters.credits.value || filters.credits.value === credits) &&
                     (!filters.department.value || filters.department.value === departmentFull.split(": ")[1]) && // Compare full name
                     (!filters.levelCategory.value || filters.levelCategory.value === levelCategory);

        row.style.display = show ? "" : "none";
    });

    updateActiveFilters();
    sortTableByCourseNumber();
}

function sortTableByCourseNumber() {
    const tbody = document.querySelector("#courseTable tbody");
    const rows = Array.from(tbody.querySelectorAll("tr"));

    const rowPairs = [];
    for (let i = 0; i < rows.length; i += 2) {
        if (!rows[i + 1]) break;
        rowPairs.push([rows[i], rows[i + 1]]);
    }

    const visiblePairs = rowPairs.filter(pair => pair[0].style.display !== "none");
    visiblePairs.sort((a, b) => {
        const courseA = a[0].cells[1].textContent.trim(); // Updated index due to checkbox column
        const courseB = b[0].cells[1].textContent.trim(); // Updated index due to checkbox column

        const yearA = a[0].cells[3].textContent.trim(); // Updated index
        const yearB = b[0].cells[3].textContent.trim(); // Updated index

        const semesterA = a[0].cells[4].textContent.trim(); // Updated index
        const semesterB = b[0].cells[4].textContent.trim(); // Updated index

        const campusA = a[0].cells[5].textContent.trim(); // Updated index
        const campusB = b[0].cells[5].textContent.trim(); // Updated index

        // Sort by course number, then year, then semester, then campus
        return courseA.localeCompare(courseB) ||
               yearA.localeCompare(yearB) ||
               semesterA.localeCompare(semesterB) ||
               campusA.localeCompare(campusB);
    });

    visiblePairs.forEach(pair => {
        tbody.appendChild(pair[0]);
        tbody.appendChild(pair[1]);
    });
}

Object.values(filters).forEach(select => {
    select.addEventListener("change", filterTable);
});

window.addEventListener("DOMContentLoaded", loadCoursesFromCSV);
</script>

</body>
</html>
